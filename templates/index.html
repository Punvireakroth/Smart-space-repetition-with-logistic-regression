{% extends "base.html" %}

{% block title %}Study Session | Smart Flashcards{% endblock %}

{% block content %}
<div class="split-layout">
    <!-- Left Panel - Flashcard Interaction (70%) -->
    <div class="panel panel-main">
        <div class="panel-header">
            <h2>Study Session</h2>
            <div class="session-stats" id="sessionStats">
                <span class="stat">
                    <span class="stat-label">Reviewed</span>
                    <span class="stat-value" id="statReviewed">0</span>
                </span>
                <span class="stat">
                    <span class="stat-label">Correct</span>
                    <span class="stat-value" id="statCorrect">0</span>
                </span>
                <span class="stat">
                    <span class="stat-label">Accuracy</span>
                    <span class="stat-value" id="statAccuracy">0%</span>
                </span>
            </div>
        </div>

        <!-- Flashcard -->
        <div class="flashcard-container">
            <div class="flashcard" id="flashcard">
                <!-- Loading State -->
                <div class="flashcard-loading" id="loadingState">
                    <p>Loading next card...</p>
                </div>

                <!-- Question State -->
                <div class="flashcard-content" id="questionState" style="display: none;">
                    <div class="card-meta">
                        <span class="difficulty" id="cardDifficulty"></span>
                        <span class="recall-badge" id="recallBadge">
                            <span class="recall-value" id="recallValue">--</span>% predicted recall
                        </span>
                    </div>

                    <div class="card-question">
                        <span class="label">Question</span>
                        <p id="questionText">Loading...</p>
                    </div>

                    <button class="btn btn-primary btn-lg" id="showAnswerBtn">
                        Show Answer
                    </button>
                </div>

                <!-- Answer State -->
                <div class="flashcard-content" id="answerState" style="display: none;">
                    <div class="card-meta">
                        <span class="difficulty" id="cardDifficulty2"></span>
                        <span class="recall-badge" id="recallBadge2">
                            <span class="recall-value" id="recallValue2">--</span>% predicted recall
                        </span>
                    </div>

                    <div class="card-question faded">
                        <span class="label">Question</span>
                        <p id="questionText2">Loading...</p>
                    </div>

                    <div class="card-answer">
                        <span class="label">Answer</span>
                        <p id="answerText">Loading...</p>
                    </div>

                    <div class="answer-buttons">
                        <button class="btn btn-success btn-lg" id="correctBtn">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="3">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            I Got It Right
                        </button>
                        <button class="btn btn-danger btn-lg" id="incorrectBtn">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="3">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                            I Got It Wrong
                        </button>
                    </div>
                </div>
            </div>

            <!-- Priority Reason -->
            <div class="priority-reason" id="priorityReason">
                <span class="priority-label">Why this card?</span>
                <span class="priority-text" id="priorityText">Loading...</span>
            </div>
        </div>
    </div>

    <!-- Right Panel - Simplified Visualizations (30%) -->
    <div class="panel panel-viz">
        <div class="panel-header">
            <h2>How Active Recall Works</h2>
        </div>

        <div class="viz-container">
            <!-- All Cards Overview - Visual Grid with Progress Rings -->
            <div class="viz-card">
                <div class="viz-card-header">
                    <h3>All 8 Cards</h3>
                    <button class="btn btn-secondary btn-sm" id="viewAllBtn">View Details</button>
                </div>
                <!-- <p class="viz-description">Each ring shows how likely you'll remember that card</p> -->
                <div class="cards-grid" id="cardsGrid">
                    <!-- Cards will be rendered here with circular progress -->
                </div>
                <div class="legend">
                    <span class="legend-item"><span class="legend-color high"></span> Strong (60%+)</span>
                    <span class="legend-item"><span class="legend-color medium"></span> Okay (35-60%)</span>
                    <span class="legend-item"><span class="legend-color low"></span> Weak (&lt;35%)</span>
                </div>
            </div>

            <!-- Why This Card Was Chosen -->
            <div class="viz-card">
                <h3>Why The Model Chose This Card</h3>
                <p class="viz-description">The model prioritizes cards you might forget</p>
                <div class="explanation-box" id="explanationBox">
                    <div class="explanation-item">
                        <svg class="explanation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <div class="explanation-content">
                            <span class="explanation-label">Last reviewed</span>
                            <span class="explanation-value" id="explainDays">--</span>
                        </div>
                    </div>
                    <div class="explanation-item">
                        <svg class="explanation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <polyline points="1 20 1 14 7 14"></polyline>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                        <div class="explanation-content">
                            <span class="explanation-label">Times practiced</span>
                            <span class="explanation-value" id="explainReviews">--</span>
                        </div>
                    </div>
                    <div class="explanation-item">
                        <svg class="explanation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        <div class="explanation-content">
                            <span class="explanation-label">Your accuracy</span>
                            <span class="explanation-value" id="explainAccuracy">--</span>
                        </div>
                    </div>
                    <div class="explanation-item">
                        <svg class="explanation-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon
                                points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2">
                            </polygon>
                        </svg>
                        <div class="explanation-content">
                            <span class="explanation-label">Difficulty</span>
                            <span class="explanation-value" id="explainDifficulty">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- View All Cards Modal -->
<div class="modal" id="cardsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>All Flashcards</h2>
            <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
            <table class="cards-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Question</th>
                        <th>Recall %</th>
                        <th>Reviews</th>
                        <th>Accuracy</th>
                        <th>Difficulty</th>
                    </tr>
                </thead>
                <tbody id="cardsTableBody">
                    <!-- Cards will be rendered here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Hidden data for JS -->
<div id="currentCardId" data-card-id="" style="display: none;"></div>
{% endblock %}